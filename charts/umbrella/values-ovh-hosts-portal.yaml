# Template values file for Portal deployment with OVH LoadBalancer
# Use generate_portal_values.sh script to create the final values file
# This template merges values-ovh-hosts.yaml and values-ovh-custom-domain.yaml

global:
  domainSuffix: "51.68.114.44.nip.io"

portal:
  portalAddress: "http://portal.51.68.114.44.nip.io"
  portalBackendAddress: "http://portal-backend.51.68.114.44.nip.io"
  centralidp:
    address: "http://centralidp.51.68.114.44.nip.io"
  sharedidpAddress: "http://sharedidp.51.68.114.44.nip.io"
  semanticsAddress: "http://semantics.51.68.114.44.nip.io"
  bpdm:
    poolAddress: "http://business-partners.51.68.114.44.nip.io"
    portalGateAddress: "http://business-partners.51.68.114.44.nip.io"
  custodianAddress: "http://ssi-dim-wallet-stub.51.68.114.44.nip.io"
  dimWrapper:
    baseAddress: "http://ssi-dim-wallet-stub.51.68.114.44.nip.io"
    tokenAddress: "http://ssi-dim-wallet-stub.51.68.114.44.nip.io/oauth/token"
  decentralIdentityManagementAuthAddress: "http://ssi-dim-wallet-stub.51.68.114.44.nip.io/api/sts"
  sdfactoryAddress: "http://sdfactory.51.68.114.44.nip.io"
  clearinghouse:
    default:
      baseAddress: "http://validation.51.68.114.44.nip.io"
      tokenAddress: "http://someiam.51.68.114.44.nip.io/realms/example/protocol/openid-connect/token"
  issuerComponentAddress: "http://ssi-credential-issuer.51.68.114.44.nip.io"
  frontend:
    ingress:
      className: "nginx"
      annotations:
        nginx.ingress.kubernetes.io/cors-allow-origin: "http://*.51.68.114.44.nip.io"
      hosts:
        - host: "portal.51.68.114.44.nip.io"
          paths:
            - path: "/(.*)"
              pathType: "ImplementationSpecific"
              backend:
                service: "portal"
                port: 8080
            - path: "/registration/(.*)"
              pathType: "ImplementationSpecific"
              backend:
                service: "registration"
                port: 8080
            - path: "/((assets|documentation)/.*)"
              pathType: "ImplementationSpecific"
              backend:
                service: "assets"
                port: 8080
  backend:
    administration:
      issuerdid: "did:web:ssi-dim-wallet-stub.51.68.114.44.nip.io:BPNL00000003CRHK"
    processesworker:
      dim:
        baseAddress: "http://ssi-dim-wallet-stub.51.68.114.44.nip.io"
    ingress:
      enabled: true
      className: "nginx"
      annotations:
        nginx.ingress.kubernetes.io/use-regex: "true"
        nginx.ingress.kubernetes.io/enable-cors: "true"
        nginx.ingress.kubernetes.io/proxy-body-size: "8m"
        nginx.ingress.kubernetes.io/cors-allow-origin: "http://localhost:3000, http://*.51.68.114.44.nip.io"
      hosts:
        - host: "portal-backend.51.68.114.44.nip.io"
          paths:
            - path: "/api/registration"
              pathType: "Prefix"
              backend:
                service: "registration-service"
                port: 8080
            - path: "/api/administration"
              pathType: "Prefix"
              backend:
                service: "administration-service"
                port: 8080
            - path: "/api/notification"
              pathType: "Prefix"
              backend:
                service: "notification-service"
                port: 8080
            - path: "/api/provisioning"
              pathType: "Prefix"
              backend:
                service: "provisioning-service"
                port: 8080
            - path: "/api/apps"
              pathType: "Prefix"
              backend:
                service: "marketplace-app-service"
                port: 8080
            - path: "/api/services"
              pathType: "Prefix"
              backend:
                service: "services-service"
                port: 8080

centralidp:
  keycloak:
    ingress:
      enabled: true
      ingressClassName: "nginx"
      hostname: "centralidp.51.68.114.44.nip.io"
      annotations:
        nginx.ingress.kubernetes.io/cors-allow-origin: "http://*.51.68.114.44.nip.io"
        nginx.ingress.kubernetes.io/enable-cors: "true"
        nginx.ingress.kubernetes.io/affinity: "cookie"
        nginx.ingress.kubernetes.io/session-cookie-name: "route"
        nginx.ingress.kubernetes.io/session-cookie-hash: "sha1"
        nginx.ingress.kubernetes.io/proxy-buffer-size: "128k"
      tls: false
    extraEnvVars:
      - name: KEYCLOAK_FRONTEND_URL
        value: "http://centralidp.51.68.114.44.nip.io/auth/"
      - name: KEYCLOAK_PROXY_ADDRESS_FORWARDING
        value: "true"
      - name: KC_SPI_STICKY_SESSION_ENCODER_INFINISPAN_SHOULD_ATTACH_ROUTE
        value: "false"
      - name: KEYCLOAK_PRODUCTION
        value: "false"
      - name: KC_HTTP_ENABLED
        value: "true"
      - name: KC_HOSTNAME_STRICT
        value: "false"
      - name: KC_HOSTNAME_STRICT_HTTPS
        value: "false"
      - name: KC_PROXY
        value: "edge"
      - name: KC_HOSTNAME
        value: "centralidp.51.68.114.44.nip.io"
      - name: KC_HOSTNAME_PATH
        value: "/auth/"

sharedidp:
  keycloak:
    ingress:
      enabled: true
      ingressClassName: "nginx"
      hostname: "sharedidp.51.68.114.44.nip.io"
      annotations:
        nginx.ingress.kubernetes.io/cors-allow-origin: "http://*.51.68.114.44.nip.io"
        nginx.ingress.kubernetes.io/enable-cors: "true"
        nginx.ingress.kubernetes.io/affinity: "cookie"
        nginx.ingress.kubernetes.io/session-cookie-name: "route"
        nginx.ingress.kubernetes.io/session-cookie-hash: "sha1"
        nginx.ingress.kubernetes.io/proxy-buffer-size: "128k"
      tls: false
    extraEnvVars:
      - name: KEYCLOAK_FRONTEND_URL
        value: "http://sharedidp.51.68.114.44.nip.io/auth/"
      - name: KEYCLOAK_PROXY_ADDRESS_FORWARDING
        value: "true"
      - name: KC_SPI_STICKY_SESSION_ENCODER_INFINISPAN_SHOULD_ATTACH_ROUTE
        value: "false"
      - name: KEYCLOAK_PRODUCTION
        value: "false"
      - name: KC_HTTP_ENABLED
        value: "true"
      - name: KC_HOSTNAME_STRICT
        value: "false"
      - name: KC_HOSTNAME_STRICT_HTTPS
        value: "false"
      - name: KC_PROXY
        value: "edge"
      - name: KC_HOSTNAME
        value: "sharedidp.51.68.114.44.nip.io"
      - name: KC_HOSTNAME_PATH
        value: "/auth/"

pgadmin4:
  ingress:
    enabled: true
    ingressClassName: nginx
    hosts:
      - host: pgadmin4.51.68.114.44.nip.io
        paths:
          - path: /
            pathType: Prefix

# BPDM Configuration
# NOTE: Use internal cluster URLs for inter-service communication
# External URLs via Ingress are only for browser/external API access
bpdm-gate:
  ingress:
    enabled: true
    className: "nginx"
    hosts:
      - host: "business-partners.51.68.114.44.nip.io"
        paths:
          - path: /gate
            pathType: Prefix
  applicationConfig:
    bpdm:
      security:
        authServerUrl: "http://centralidp.51.68.114.44.nip.io/auth"
      pool:
        baseUrl: "http://portal-bpdm-pool:80"
      orchestrator:
        baseUrl: "http://portal-bpdm-orchestrator:80"

bpdm-pool:
  ingress:
    enabled: true
    className: "nginx"
    hosts:
      - host: "business-partners.51.68.114.44.nip.io"
        paths:
          - path: /pool
            pathType: Prefix
  applicationConfig:
    bpdm:
      security:
        authServerUrl: "http://centralidp.51.68.114.44.nip.io/auth"
      orchestrator:
        baseUrl: "http://portal-bpdm-orchestrator:80"

bpdm-orchestrator:
  ingress:
    enabled: true
    className: "nginx"
    hosts:
      - host: "business-partners.51.68.114.44.nip.io"
        paths:
          - path: /orchestrator
            pathType: Prefix

bpdm-cleaning-service-dummy:
  applicationConfig:
    bpdm:
      orchestrator:
        baseUrl: "http://portal-bpdm-orchestrator:80"
