# Template values file for Portal deployment with OVH LoadBalancer
# Use generate_portal_values.sh script to create the final values file
# This template merges values-ovh-hosts.yaml and values-ovh-custom-domain.yaml

global:
  domainSuffix: "{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"

portal:
  portalAddress: "http://portal.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
  portalBackendAddress: "http://portal-backend.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
  centralidp:
    address: "http://centralidp.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
  sharedidpAddress: "http://sharedidp.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
  semanticsAddress: "http://semantics.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
  bpdm:
    poolAddress: "http://business-partners.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
    portalGateAddress: "http://business-partners.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
  custodianAddress: "http://ssi-dim-wallet-stub.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
  dimWrapper:
    baseAddress: "http://ssi-dim-wallet-stub.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
    tokenAddress: "http://ssi-dim-wallet-stub.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}/oauth/token"
  decentralIdentityManagementAuthAddress: "http://ssi-dim-wallet-stub.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}/api/sts"
  sdfactoryAddress: "http://sdfactory.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
  clearinghouse:
    default:
      baseAddress: "http://validation.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
      tokenAddress: "http://someiam.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}/realms/example/protocol/openid-connect/token"
  issuerComponentAddress: "http://ssi-credential-issuer.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
  frontend:
    ingress:
      className: "nginx"
      annotations:
        nginx.ingress.kubernetes.io/cors-allow-origin: "http://*.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
      hosts:
        - host: "portal.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
          paths:
            - path: "/(.*)"
              pathType: "ImplementationSpecific"
              backend:
                service: "portal"
                port: 8080
            - path: "/registration/(.*)"
              pathType: "ImplementationSpecific"
              backend:
                service: "registration"
                port: 8080
            - path: "/((assets|documentation)/.*)"
              pathType: "ImplementationSpecific"
              backend:
                service: "assets"
                port: 8080
  backend:
    administration:
      issuerdid: "did:web:ssi-dim-wallet-stub.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}:BPNL00000003CRHK"
    processesworker:
      dim:
        baseAddress: "http://ssi-dim-wallet-stub.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
    ingress:
      enabled: true
      className: "nginx"
      annotations:
        nginx.ingress.kubernetes.io/use-regex: "true"
        nginx.ingress.kubernetes.io/enable-cors: "true"
        nginx.ingress.kubernetes.io/proxy-body-size: "8m"
        nginx.ingress.kubernetes.io/cors-allow-origin: "http://localhost:3000, http://*.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
      hosts:
        - host: "portal-backend.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
          paths:
            - path: "/api/registration"
              pathType: "Prefix"
              backend:
                service: "registration-service"
                port: 8080
            - path: "/api/administration"
              pathType: "Prefix"
              backend:
                service: "administration-service"
                port: 8080
            - path: "/api/notification"
              pathType: "Prefix"
              backend:
                service: "notification-service"
                port: 8080
            - path: "/api/provisioning"
              pathType: "Prefix"
              backend:
                service: "provisioning-service"
                port: 8080
            - path: "/api/apps"
              pathType: "Prefix"
              backend:
                service: "marketplace-app-service"
                port: 8080
            - path: "/api/services"
              pathType: "Prefix"
              backend:
                service: "services-service"
                port: 8080

centralidp:
  realmSeeding:
    initContainer:
      image:
        name: "docker.io/xmendialdua/catena-x-init:v1"
  keycloak:
    ingress:
      enabled: true
      ingressClassName: "nginx"
      hostname: "centralidp.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
      annotations:
        nginx.ingress.kubernetes.io/cors-allow-origin: "http://*.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
        nginx.ingress.kubernetes.io/enable-cors: "true"
        nginx.ingress.kubernetes.io/affinity: "cookie"
        nginx.ingress.kubernetes.io/session-cookie-name: "route"
        nginx.ingress.kubernetes.io/session-cookie-hash: "sha1"
        nginx.ingress.kubernetes.io/proxy-buffer-size: "128k"
      tls: false
    extraEnvVars:
      - name: KEYCLOAK_FRONTEND_URL
        value: "http://centralidp.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}/auth/"
      - name: KEYCLOAK_PROXY_ADDRESS_FORWARDING
        value: "true"
      - name: KC_SPI_STICKY_SESSION_ENCODER_INFINISPAN_SHOULD_ATTACH_ROUTE
        value: "false"
      - name: KEYCLOAK_PRODUCTION
        value: "false"
      - name: KC_HTTP_ENABLED
        value: "true"
      - name: KC_HOSTNAME_STRICT
        value: "false"
      - name: KC_HOSTNAME_STRICT_HTTPS
        value: "false"
      - name: KC_PROXY
        value: "edge"
      - name: KC_HOSTNAME
        value: "centralidp.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
      - name: KC_HOSTNAME_PATH
        value: "/auth/"

sharedidp:
  realmSeeding:
    initContainer:
      image:
        name: "docker.io/xmendialdua/catena-x-init:v1"
  keycloak:
    ingress:
      enabled: true
      ingressClassName: "nginx"
      hostname: "sharedidp.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
      annotations:
        nginx.ingress.kubernetes.io/cors-allow-origin: "http://*.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
        nginx.ingress.kubernetes.io/enable-cors: "true"
        nginx.ingress.kubernetes.io/affinity: "cookie"
        nginx.ingress.kubernetes.io/session-cookie-name: "route"
        nginx.ingress.kubernetes.io/session-cookie-hash: "sha1"
        nginx.ingress.kubernetes.io/proxy-buffer-size: "128k"
      tls: false
    extraEnvVars:
      - name: KEYCLOAK_FRONTEND_URL
        value: "http://sharedidp.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}/auth/"
      - name: KEYCLOAK_PROXY_ADDRESS_FORWARDING
        value: "true"
      - name: KC_SPI_STICKY_SESSION_ENCODER_INFINISPAN_SHOULD_ATTACH_ROUTE
        value: "false"
      - name: KEYCLOAK_PRODUCTION
        value: "false"
      - name: KC_HTTP_ENABLED
        value: "true"
      - name: KC_HOSTNAME_STRICT
        value: "false"
      - name: KC_HOSTNAME_STRICT_HTTPS
        value: "false"
      - name: KC_PROXY
        value: "edge"
      - name: KC_HOSTNAME
        value: "sharedidp.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
      - name: KC_HOSTNAME_PATH
        value: "/auth/"

pgadmin4:
  ingress:
    enabled: true
    ingressClassName: nginx
    hosts:
      - host: pgadmin4.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}
        paths:
          - path: /
            pathType: Prefix

# BPDM Configuration
# NOTE: Use internal cluster URLs for inter-service communication
# External URLs via Ingress are only for browser/external API access
bpdm-gate:
  ingress:
    enabled: true
    className: "nginx"
    hosts:
      - host: "business-partners.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
        paths:
          - path: /gate
            pathType: Prefix
  applicationConfig:
    bpdm:
      security:
        authServerUrl: "http://centralidp.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}/auth"
      pool:
        baseUrl: "http://portal-bpdm-pool:80"
      orchestrator:
        baseUrl: "http://portal-bpdm-orchestrator:80"

bpdm-pool:
  ingress:
    enabled: true
    className: "nginx"
    hosts:
      - host: "business-partners.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
        paths:
          - path: /pool
            pathType: Prefix
  applicationConfig:
    bpdm:
      security:
        authServerUrl: "http://centralidp.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}/auth"
      orchestrator:
        baseUrl: "http://portal-bpdm-orchestrator:80"

bpdm-orchestrator:
  ingress:
    enabled: true
    className: "nginx"
    hosts:
      - host: "business-partners.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
        paths:
          - path: /orchestrator
            pathType: Prefix

bpdm-cleaning-service-dummy:
  applicationConfig:
    bpdm:
      orchestrator:
        baseUrl: "http://portal-bpdm-orchestrator:80"

smtp4dev:
  ingress:
    enabled: true
    className: "nginx"
    hosts:
      - host: "smtp4dev.{{LOAD_BALANCER_IP}}{{DNS_SUFFIX}}"
        paths:
          - path: /
            pathType: Prefix
