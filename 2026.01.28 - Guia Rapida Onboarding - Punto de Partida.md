# Gu√≠a R√°pida para Onboarding de Business Partners
**Fecha:** 28 de Enero de 2026  
**Estado Actual:** Ikerlan completado ‚úÖ | Assembly pendiente ‚è≥  
**Punto de partida para:** Segundo onboarding (Assembly)

---

## üìö Resumen de Documentaci√≥n Actualizada

### 1. **Documento Principal Completo** 
`2026.01.27 - Onboarding Ikerlan - Proceso Completo.md`

**Contenido:**
- ‚úÖ Resumen ejecutivo con estado final
- ‚úÖ **PROCEDIMIENTO OPTIMIZADO** (10 pasos claros para pr√≥ximo onboarding)
- ‚úÖ Documentaci√≥n completa con todos los errores encontrados
- ‚úÖ 12 problemas documentados con sus soluciones
- ‚úÖ Lecciones aprendidas
- ‚úÖ Troubleshooting com√∫n
- ‚úÖ Pr√≥ximos pasos para Assembly y Fagor

---

### 2. **Procedimiento R√°pido para Copy-Paste**
`onboarding/PROCEDIMIENTO-ONBOARDING-OPTIMIZADO.md`

**Contenido:**
- ‚úÖ Checklist de 10 pasos
- ‚úÖ Comandos listos para ejecutar (solo cambiar variables)
- ‚úÖ Tiempo estimado: 15-20 minutos
- ‚úÖ Valores preparados para Assembly (idp2) y Fagor (idp3)
- ‚úÖ Troubleshooting r√°pido

---

### 3. **Datos de Ikerlan Actualizados**
`onboarding/Ikerlan.txt`

**Contenido:**
- ‚úÖ Estado: COMPLETADO
- ‚úÖ Resumen de configuraci√≥n final
- ‚úÖ Lecciones aprendidas
- ‚úÖ URLs y credenciales

---

## üéØ Para Hoy (28-Ene-2026) - Onboarding Assembly

**Preparaci√≥n:**
1. Crear archivo `onboarding/Assembly.txt` con datos de la empresa
2. Tener abierto el documento **PROCEDIMIENTO-ONBOARDING-OPTIMIZADO.md**
3. Preparar terminal con kubectl configurado

**Valores a usar:**
- **Realm:** `idp2`
- **Display Name:** `Assembly`
- **BPN:** `BPNL000000002ASM`
- **Email:** [el que corresponda]

**Tiempo estimado:** 15-20 minutos si no hay problemas

---

## ‚úÖ Logros de Ayer (27-Ene-2026)

1. ‚úÖ **Ikerlan onboarding completado** - Usuario puede hacer login
2. ‚úÖ **Arquitectura de realms entendida** - idp1, idp2, idp3 con displayNames
3. ‚úÖ **12 problemas resueltos** - Documentados para evitar repetirlos
4. ‚úÖ **Procedimiento optimizado creado** - Listo para replicar
5. ‚úÖ **Documentaci√≥n completa** - Todo versionado y listo para git

---

## üöÄ Flujo de Trabajo R√°pido para Assembly

### Antes de Empezar
```bash
# Verificar acceso al cluster
kubectl get pods -n portal | grep -E "(portal-portal|sharedidp)"

# Verificar que Ikerlan sigue funcionando
curl -s http://portal.51.68.114.44.nip.io > /dev/null && echo "‚úÖ Portal accesible"
```

### Ejecuci√≥n
1. **Seguir:** `onboarding/PROCEDIMIENTO-ONBOARDING-OPTIMIZADO.md`
2. **Variables clave:**
   - `REALM_ALIAS="idp2"`
   - `DISPLAY_NAME="Assembly"`
   - `USER_EMAIL="contacto@assembly.com"`
   - `BPN="BPNL000000002ASM"`

### Despu√©s de Completar
- [ ] Actualizar este documento con el resultado
- [ ] Crear `onboarding/Assembly.txt` con datos finales
- [ ] Preparar para Fagor (idp3)

---

## üìã Checklist R√°pido (Copiar de PROCEDIMIENTO-ONBOARDING-OPTIMIZADO.md)

- [ ] PASO 1: Preparar datos del Business Partner
- [ ] PASO 2: Crear invitaci√≥n en Portal UI
- [ ] PASO 3: Identificar identity provider alias (idp2 esperado)
- [ ] PASO 4: Configurar realm en Keycloak (sslRequired: none)
- [ ] PASO 5: Crear cliente OAuth2 (Cl2-CX-Portal)
- [ ] PASO 6: Obtener usuario y configurar contrase√±a
- [ ] PASO 7: Actualizar base de datos (user_entity_id + BPN)
- [ ] PASO 8: Verificar REQUIRE_HTTPS en false
- [ ] PASO 9: Reiniciar servicios del Portal
- [ ] PASO 10: Probar login

---

## ‚ö†Ô∏è Recordatorios Importantes

### De la Experiencia con Ikerlan

1. **El realm usa ID t√©cnico (idp2), NO el nombre de la empresa**
   - Correcto: `idp2` con displayName "Assembly"
   - Incorrecto: `CX-Operator-Assembly`

2. **SSL debe estar deshabilitado**
   ```json
   "sslRequired": "none"
   ```

3. **Cada realm necesita su propio cliente OAuth2**
   - ClientId: `Cl2-CX-Portal`
   - RedirectUris: `http://portal.51.68.114.44.nip.io/*`

4. **El user_entity_id debe ser el UUID de Keycloak**
   - Obtener con: `curl .../realms/idp2/users?email=...`

5. **Reiniciar pods del Portal despu√©s de cambios en BD**
   ```bash
   kubectl delete pod -n portal -l app.kubernetes.io/name=portal
   ```

6. **Probar siempre en modo inc√≥gnito**
   - Evita problemas de cach√© del navegador

---

## üîó Arquitectura de Realms (Recordatorio)

```
Shared IDP (Keycloak)
‚îú‚îÄ‚îÄ master (realm admin)
‚îú‚îÄ‚îÄ CX-Operator (realm del operador del Portal)
‚îî‚îÄ‚îÄ Business Partner Realms:
    ‚îú‚îÄ‚îÄ idp1 (displayName: "Ikerlan")     ‚úÖ COMPLETADO
    ‚îú‚îÄ‚îÄ idp2 (displayName: "Assembly")    ‚è≥ HOY
    ‚îú‚îÄ‚îÄ idp3 (displayName: "Fagor")       ‚è≥ SIGUIENTE
    ‚îî‚îÄ‚îÄ idp4, idp5, ... (futuros partners)
```

---

## üìû Recursos Clave

| Recurso | Ubicaci√≥n |
|---------|-----------|
| Portal UI | http://portal.51.68.114.44.nip.io |
| Shared IDP | http://sharedidp.51.68.114.44.nip.io/auth |
| Procedimiento detallado | `onboarding/PROCEDIMIENTO-ONBOARDING-OPTIMIZADO.md` |
| Ejemplo completo | `onboarding/Ikerlan.txt` |
| Troubleshooting | `2026.01.27 - Onboarding Ikerlan - Proceso Completo.md` (final) |

---

## üéØ Siguiente: Fagor

**Despu√©s de completar Assembly:**
- **Realm:** `idp3`
- **Display Name:** `Fagor`
- **BPN:** `BPNL000000003FGR`
- **Procedimiento:** Mismo que Assembly

---

**Documento creado:** 28 de Enero de 2026  
**Autor:** xmendialdua  
**Prop√≥sito:** Punto de partida r√°pido para onboarding de Assembly  
**Actualizar tras completar:** Marcar Assembly como ‚úÖ y actualizar secci√≥n de logros
