===============================================================================
DATOS DE IKERLAN PARA ONBOARDING EN CATENA-X
===============================================================================
Fecha de preparaci√≥n: 27 de Enero de 2026
Fecha de completaci√≥n: 27 de Enero de 2026 - 21:15
Estado: ‚úÖ COMPLETADO - Usuario puede hacer login en Portal
===============================================================================

INFORMACI√ìN LEGAL Y FISCAL
---------------------------
Nombre legal:           Ikerlan, S. Coop.
Nombre corto:           Ikerlan
Forma legal:            S.COOP (Sociedad Cooperativa)
CIF/NIF:                ESF20459407
Registro:               Registro de Fundaciones del Pa√≠s Vasco
Sitio web:              https://www.ikerlan.es


DIRECCI√ìN LEGAL
---------------
Calle/Avenida:          Paseo J.M. Arizmendiarrieta
N√∫mero:                 2
C√≥digo postal:          20500
Ciudad:                 Arrasate-Mondrag√≥n
Provincia:              Guip√∫zcoa
Pa√≠s:                   Espa√±a (ES)
Pa√≠s (ISO):             ES


ACTIVIDAD Y CLASIFICACI√ìN
--------------------------
Descripci√≥n:            Centro de investigaci√≥n y desarrollo tecnol√≥gico
√Åreas principales:      Electr√≥nica, Energ√≠a, Sistemas de Informaci√≥n, Mecatr√≥nica
Sectores:               Automoci√≥n, Energ√≠as Renovables, Electr√≥nica Industrial
Clasificaci√≥n NACE:     72.19 (Investigaci√≥n y desarrollo en otras ciencias naturales y t√©cnicas)
Tipo de negocio:        RESEARCH_DEVELOPMENT
Miembro de:             Basque Research and Technology Alliance (BRTA)
                        Corporaci√≥n Mondrag√≥n


CONTACTO PRINCIPAL
------------------
Nombre y apellidos:     Xabier Mendialdua
Email corporativo:      xmendialdua@ikerlan.es
Tel√©fono:               +34 943 712 400 (centralita)
Cargo:                  Responsable de Onboarding Catena-X


DATOS CATENA-X
--------------
BPN (Business Partner Number):  BPNL000000001IKL
Realm Keycloak:                 idp1 (Display Name: "Ikerlan") ‚úÖ CONFIGURADO
Realm URL:                      http://sharedidp.51.68.114.44.nip.io/auth/realms/idp1
Usuario admin inicial:          xmendialdua@ikerlan.es ‚úÖ CREADO
Usuario UUID (Keycloak):        07950d56-7357-4b65-acaf-87626ddddfc1
Password temporal:              Welcome2Catena-X! (CAMBIAR EN PRIMER LOGIN)
Rol asignado:                   Company Admin ‚úÖ ASIGNADO
Cliente OAuth2:                 Cl2-CX-Portal ‚úÖ CREADO
SSL Required:                   none (HTTP permitido) ‚úÖ CONFIGURADO
Estado en BPDM Pool:            ‚è≥ Pendiente de sincronizaci√≥n desde Portal UI
Estado del Onboarding:          ‚úÖ COMPLETO - Listo para login


===============================================================================
INSTRUCCIONES PARA PRIMER ACCESO AL PORTAL
===============================================================================

1. Abrir navegador web (recomendado: modo inc√≥gnito para evitar cach√©)
2. Navegar a: http://portal.51.68.114.44.nip.io
3. Hacer clic en "Login"
4. El sistema redirigir√° autom√°ticamente a Shared IDP (realm idp1)
5. Ingresar credenciales:
   - Username: xmendialdua@ikerlan.es
   - Password: Welcome2Catena-X!
6. El sistema pedir√° cambiar el password (es temporal)
7. Establecer un password seguro nuevo
8. Completar el perfil si es solicitado
9. Verificar que aparece el BPN: BPNL000000001IKL en el perfil

NOTA T√âCNICA:
- El realm t√©cnico es "idp1" (identificador en base de datos)
- El Display Name es "Ikerlan" (nombre descriptivo)
- Otros partners usar√°n idp2, idp3, etc. con sus nombres respectivos

===============================================================================
PROBLEMAS ENCONTRADOS DURANTE EL ONBOARDING
===============================================================================

‚ùå PROBLEMA: Flujo autom√°tico bloqueado por falta de servidor SMTP
‚úÖ SOLUCI√ìN: Creaci√≥n manual de Realm + Usuario en Keycloak

‚ùå PROBLEMA: API BPDM Pool v6 no documentada  
‚úÖ SOLUCI√ìN: Portal sincronizar√° con BPDM al completar login


===============================================================================
JSON PARA BPDM API (POST /v7/business-partners)
===============================================================================

{
  "legalName": "Ikerlan, S. Coop.",
  "shortName": "Ikerlan",
  "legalForm": "S.COOP",
  "status": "ACTIVE",
  "classifications": [
    {
      "value": "RESEARCH_DEVELOPMENT",
      "code": "NACE",
      "type": "72.19"
    }
  ],
  "addresses": [
    {
      "addressType": "LEGAL_ADDRESS",
      "physicalPostalAddress": {
        "country": "ES",
        "city": "Arrasate-Mondrag√≥n",
        "postalCode": "20500",
        "street": {
          "name": "Paseo J.M. Arizmendiarrieta",
          "houseNumber": "2"
        }
      }
    }
  ],
  "identifiers": [
    {
      "type": "VAT_ID",
      "value": "ESF20459407",
      "issuingBody": "Agencia Tributaria Espa√±a"
    }
  ]
}


===============================================================================
COMANDO CURL PARA CREACI√ìN EN BPDM
===============================================================================

# 1. Obtener token de autenticaci√≥n
TOKEN=$(curl -s -X POST "http://centralidp.51.68.114.44.nip.io/auth/realms/CX-Central/protocol/openid-connect/token" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "grant_type=client_credentials" \
  -d "client_id=Cl7-CX-BPDM" \
  -d "client_secret=SECRETO_DEL_CLIENTE" | jq -r '.access_token')

# 2. Crear Business Partner en BPDM Pool
curl -X POST "http://business-partners.51.68.114.44.nip.io/pool/v7/business-partners" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "legalName": "Ikerlan, S. Coop.",
    "shortName": "Ikerlan",
    "legalForm": "S.COOP",
    "status": "ACTIVE",
    "classifications": [
      {
        "value": "RESEARCH_DEVELOPMENT",
        "code": "NACE",
        "type": "72.19"
      }
    ],
    "addresses": [
      {
        "addressType": "LEGAL_ADDRESS",
        "physicalPostalAddress": {
          "country": "ES",
          "city": "Arrasate-Mondrag√≥n",
          "postalCode": "20500",
          "street": {
            "name": "Paseo J.M. Arizmendiarrieta",
            "houseNumber": "2"
          }
        }
      }
    ],
    "identifiers": [
      {
        "type": "VAT_ID",
        "value": "ESF20459407",
        "issuingBody": "Agencia Tributaria Espa√±a"
      }
    ]
  }' | jq


===============================================================================
VERIFICACI√ìN PREVIA AL ONBOARDING
===============================================================================

# Verificar si Ikerlan ya existe en BPDM Pool
curl -X GET "http://business-partners.51.68.114.44.nip.io/pool/v7/business-partners?legalName=Ikerlan" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" | jq


===============================================================================
TAREAS PENDIENTES ANTES DE PROCEDER
===============================================================================

[X] Contactar con Ikerlan para obtener:
    [X] Nombre del contacto principal (Xabier Mendialdua)
    [X] Email corporativo del contacto (xmendialdua@ikerlan.es)
    [ ] Confirmaci√≥n de datos legales y fiscales
    [ ] Autorizaci√≥n para registro en Catena-X

[ ] Verificar en BPDM Pool si ya existe un registro previo

[ ] Confirmar el secret del cliente Keycloak (Cl7-CX-BPDM)

[ ] Preparar credenciales temporales para el usuario admin


===============================================================================
NOTAS ADICIONALES
===============================================================================

- Ikerlan es parte de la Corporaci√≥n Mondrag√≥n, una de las cooperativas m√°s 
  grandes de Espa√±a
  
- Como centro de I+D, pueden tener inter√©s en casos de uso de Catena-X 
  relacionados con trazabilidad, econom√≠a circular y gemelos digitales
  
- Su experiencia en automoci√≥n los hace candidatos ideales para participar 
  en la red Catena-X
  
- Al ser cooperativa, pueden tener estructuras de gobernanza espec√≠ficas 
  que requieran ajustes en el proceso de onboarding


===============================================================================
ESTADO ACTUAL DE AUTENTICACI√ìN (27-Ene-2026 21:00) ‚úÖ COMPLETADO
===============================================================================

‚úÖ Base de Datos Portal:
   - Empresa Ikerlan creada (ID: 30bdf87c-7813-406a-827f-a8977f154980)
   - BPN asignado: BPNL000000001IKL
   - Usuario creado: xmendialdua@ikerlan.es (ID: 6ce4fdb0-7264-41b1-aeb6-4b224ebb7b1f)
   - Identity Provider: idp1 (iam_idp_alias t√©cnico)
   - Link identity_provider ‚Üí company: CORRECTO
   - Link user_entity_id ‚Üí Keycloak UUID: 07950d56-7357-4b65-acaf-87626ddddfc1 ‚úÖ

‚úÖ Keycloak Shared IDP - Realm idp1:
   - Realm: idp1 (Display Name: "Ikerlan") ‚úÖ CONFIGURADO
   - sslRequired: "none" (permite HTTP) ‚úÖ CORRECTO
   - Usuario: xmendialdua@ikerlan.es (UUID: 07950d56-7357-4b65-acaf-87626ddddfc1)
   - Password: Welcome2Catena-X! (temporary: false)
   - Rol: Company Admin ‚úÖ ASIGNADO
   - Cliente OAuth2: Cl2-CX-Portal ‚úÖ CREADO
   - redirectUris: http://portal.51.68.114.44.nip.io/* ‚úÖ CORRECTAS

‚úÖ Portal Frontend:
   - REQUIRE_HTTPS_URL_PATTERN: false ‚úÖ DESHABILITADO
   - Pods reiniciados con configuraci√≥n actualizada

‚úÖ CONFIGURACI√ìN CORRECTA:
   La arquitectura usa identificadores t√©cnicos (idp1, idp2, idp3) para los realms
   mientras que el displayName muestra el nombre de la empresa (Ikerlan, Assembly, Fagor).
   
   Esto permite:
   - URLs estables: http://sharedidp.../auth/realms/idp1/...
   - Nombres descriptivos en la UI de Keycloak
   - Escalabilidad para m√∫ltiples partners

üéØ LISTO PARA LOGIN:
   http://portal.51.68.114.44.nip.io
   Email: xmendialdua@ikerlan.es
   Password: Welcome2Catena-X!


===============================================================================
REFERENCIAS
===============================================================================

Documento de proceso:   2026.01.27 - Onboarding Ikerlan - Proceso Completo.md
Configuraci√≥n Ingress:  fix-bpdm-ingress.sh
Values Portal:          charts/umbrella/values-ovh-hosts-portal.yaml
